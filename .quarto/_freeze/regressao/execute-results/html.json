{
  "hash": "f3bd77a92816f6193f3f562f8da7a45f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"regressao\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)        # Importa planilhas do Google Sheets\nlibrary(ggplot2)       # Gráficos\nlibrary(tidyverse)     # Manipulação de dados (dplyr, tidyr etc.)\nlibrary(lme4)          # Modelos lineares mistos\nlibrary(car)           # Função Anova para modelos mistos\nlibrary(drc)           # Ajuste de modelos dose-resposta (log-logístico)\nlibrary(ec50estimator) # Estimativa automatizada de EC50\n```\n:::\n\n\n\n\n# Análise de regressão\n\n### **Introdução teórica**\n\nA análise de regressão é utilizada quando se deseja avaliar a relação entre uma variável independente (ou preditora) e uma variável dependente (ou resposta). No caso da **regressão linear**, o modelo assume que há uma relação linear entre as variáveis. A equação geral é:\n\nY=β0​+β1​X+ϵ\n\nJá a **regressão não linear** é usada quando os dados não seguem um padrão linear. Um exemplo comum em estudos de sensibilidade é o modelo log-logístico de três parâmetros (LL.3), que é frequentemente usado para modelar respostas a doses crescentes, como a inibição da germinação por fungos.\n\n## Regressão linear simples por experimento\n\n### Objetivo\n\nAvaliar o efeito de diferentes níveis de inóculo de sementes sobre o número de plantas emergidas (variável resposta `nplants`) em **três experimentos independentes** (`exp`), por meio de **modelos de regressão linear simples**.\n\n### Importação e visualização dos dados\n\nFoi utilizado um conjunto de dados (`estande`) com três experimentos avaliando o efeito do percentual de inóculo de sementes (`trat`) sobre o número de plantas emergidas (`nplants`).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=401662555#gid=401662555\")\n```\n:::\n\n\n\n\nA visualização inicial mostra os pontos de cada experimento com ajuste de linha de regressão linear:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nview(estande)\n#trat = nível de inóculo na semente\nlibrary(ggplot2)\nestande |> ggplot(aes(trat, nplants))+\n  geom_point (color = \"yellow\") +\n  geom_smooth(method = \"lm\", se = TRUE,\n              color = \"orange\") +\n  facet_wrap(~exp) +\n  theme_minimal() +\n  labs (x = \"% de inóculo de semente\",\n        y = \"Número de plantas\")\n```\n\n::: {.cell-output-display}\n![](regressao_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n### Ajuste do modelo linear por experimento\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n#Experimento 01\nexp1 <- estande |> \n  filter(exp == 1)\n\nm_exp1 <- lm(nplants ~ trat, data = exp1)\nsummary(m_exp1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp1)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.500  -6.532   1.758   8.573  27.226 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15 on 22 degrees of freedom\nMultiple R-squared:  0.07148,\tAdjusted R-squared:  0.02928 \nF-statistic: 1.694 on 1 and 22 DF,  p-value: 0.2066\n```\n\n\n:::\n\n```{.r .cell-code}\n#Experimento 02\nexp2 <- estande |> \n  filter(exp == 2)\n\nm_exp2 <- lm(nplants ~ trat, data = exp2)\nsummary(m_exp2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7816  -7.7150   0.5653   8.1929  19.2184 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     3.6304  16.798 4.93e-14 ***\ntrat         -0.7007     0.1605  -4.365 0.000247 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.95 on 22 degrees of freedom\nMultiple R-squared:  0.4641,\tAdjusted R-squared:  0.4398 \nF-statistic: 19.05 on 1 and 22 DF,  p-value: 0.0002473\n```\n\n\n:::\n\n```{.r .cell-code}\n#Experimento 03\nexp3 <- estande |> \n  filter(exp == 3)\n\nm_exp3 <- lm(nplants ~ trat, data = exp3)\nsummary(m_exp3) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp3)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-26.5887  -3.9597   0.7177   5.5806  19.8952 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  95.7500     2.9529  32.425  < 2e-16 ***\ntrat         -0.7634     0.1306  -5.847 6.97e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.53 on 22 degrees of freedom\nMultiple R-squared:  0.6085,\tAdjusted R-squared:  0.5907 \nF-statistic: 34.19 on 1 and 22 DF,  p-value: 6.968e-06\n```\n\n\n:::\n:::\n\n\n\n\nForam conduzidos três experimentos independentes para avaliar o efeito do nível de inóculo aplicado às sementes sobre a emergência de plantas. Para cada experimento, foi ajustado um modelo de regressão linear simples, considerando o número de plantas emergidas como variável resposta (`nplants`) e o percentual de inóculo como variável explicativa (`trat`).\n\nNo **Experimento 1**, não foi observada relação estatisticamente significativa entre o nível de inóculo e o número de plantas (p = 0,207), com baixa explicação da variância (R² = 7,1%).\n\nJá no **Experimento 2**, o aumento do inóculo resultou em **redução significativa** na emergência (p \\< 0,001), com um decréscimo médio de 0,70 plantas para cada 1% de inóculo, e um bom ajuste do modelo (R² = 46,4%).\n\nO **Experimento 3** apresentou o efeito mais evidente, com **redução altamente significativa** da emergência (p \\< 0,001), uma inclinação de -0,76 e explicação robusta da variação (R² = 60,8%).\n\nEm conjunto, os resultados indicam que o aumento do nível de inóculo nas sementes pode prejudicar a emergência de plantas, embora esse efeito varie entre experimentos. Isso sugere que fatores específicos de cada experimento, como ambiente ou manejo, podem influenciar a intensidade da resposta. Um modelo misto, incluindo o experimento como efeito aleatório, pode capturar essa variação de forma mais apropriada.\n\n# Modelo misto (com bloco como efeito aleatório)\n\nQuando os experimentos envolvem blocos (como repetição experimental), podemos considerar o **efeito aleatório** desses blocos com um modelo misto. Nesse caso, foi considerado o modelo abaixo.\n\nEsse modelo permite levar em conta a variação entre experimentos e entre blocos dentro de cada experimento.\n\nA função `Anova()` fornece os valores de F e os p-valores para o efeito fixo de `trat`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nm_misto <- lmer(nplants ~trat + (1 | exp/bloco), data = estande)\nconfint(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 2.5 %     97.5 %\n.sig01       3.3332097 14.4218422\n.sig02       7.2377419 47.8269818\n.sigma       9.7314178 13.9359486\n(Intercept) 43.4631239 96.0274587\ntrat        -0.7328972 -0.4044812\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(car)\ncar::Anova(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: nplants\n      Chisq Df Pr(>Chisq)    \ntrat 46.788  1  7.909e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: nplants ~ trat + (1 | exp/bloco)\n   Data: estande\n\nREML criterion at convergence: 575.8\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.21697 -0.63351  0.04292  0.67094  1.92907 \n\nRandom effects:\n Groups    Name        Variance Std.Dev.\n bloco:exp (Intercept)  54.76    7.40   \n exp       (Intercept) 377.43   19.43   \n Residual              134.99   11.62   \nNumber of obs: 72, groups:  bloco:exp, 12; exp, 3\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept) 69.74524   11.57191   6.027\ntrat        -0.56869    0.08314  -6.840\n\nCorrelation of Fixed Effects:\n     (Intr)\ntrat -0.111\n```\n\n\n:::\n:::\n\n\n\n\n### Visualização de dados\n\nA reta de regressão ajustada com os coeficientes estimados foi visualizada através do código abaixo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestande |> \n  ggplot(aes(trat, nplants, color = factor(exp))) +\n  geom_point()+\n  #geom_smooth(method = \"lm\", se = FALSE) +\n  geom_abline(intercept = 69.74524,\n                slope = -0.568, linewidth = 2) +\n  geom_abline(intercept = 43,\n              slope = -0.73, linetype = \"dashed\")+\n  geom_abline(intercept = 96,\n              slope = -0.40, linetype = \"dashed\")\n```\n\n::: {.cell-output-display}\n![](regressao_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n# Regressão não linear (modelo log-logístico)\n\n### **Objetivo do experimento**\n\nAvaliar o efeito de diferentes doses de inóculo sobre a **germinação de sementes**, considerando diferentes **isolados fúngicos (code)**, usando um modelo de regressão não linear **log-logístico (LL.3)** para estimar a **EC50** — a dose necessária para reduzir a germinação em 50%.\n\n### Importação e visualização dos dados **Descrição:** Os dados contêm as variáveis\n\n-   `code`: identificador do isolado fúngico;\n\n-   `dose`: dose do inóculo;\n\n-   `germination`: porcentagem de germinação;\n\n-   `state`: origem do isolado.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfungi <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=465348652#gid=465348652\")\nview(fungi)\n```\n:::\n\n\n\n\n### Visualização da germinação por dose e isolado\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfungi |>\n  group_by(code, dose) |>  \n  summarise(germination = mean (germination)) |> \n  ggplot(aes(dose, germination)) +\n  geom_point()+\n  geom_line()+\n  facet_wrap(~ code)\n```\n\n::: {.cell-output-display}\n![](regressao_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n**Interpretação:** Este gráfico permite visualizar como a germinação varia com a dose para **cada isolado**. Em geral, espera-se uma **tendência de redução da germinação com o aumento da dose**, sugerindo um efeito inibitório do inóculo.\n\n### Ajuste do modelo log-logístico para um isolado específico (exemplo: FGT43)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(drc)\n\n#Separar por isolado\nFGT43 <- fungi |> \n  group_by(code, dose) |> \n  summarise(germination = mean(germination)) |> \n  filter(code == \"FGT43\")\n\n#MODELO LL.3, PODE SER WP.3\nlibrary(drc)\nm43 <- drm(germination ~dose,\n           data = FGT43,\n           fct = LL.3())\nsummary(m43)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nModel fitted: Log-logistic (ED50 as parameter) with lower limit at 0 (3 parms)\n\nParameter estimates:\n\n               Estimate Std. Error t-value   p-value    \nb:(Intercept)  1.219692   0.175081  6.9664  0.006069 ** \nd:(Intercept) 48.486911   1.456007 33.3013 5.952e-05 ***\ne:(Intercept)  0.495895   0.060851  8.1494  0.003864 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error:\n\n 1.636105 (3 degrees of freedom)\n```\n\n\n:::\n\n```{.r .cell-code}\nAIC(m43)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 26.7762\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(m43)\n```\n\n::: {.cell-output-display}\n![](regressao_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n**Interpretação do modelo:**\n\n-   **Modelo:** log-logístico com 3 parâmetros:\n\n    -   `b`: inclinação da curva;\n\n    -   `d`: valor máximo da resposta (germinação);\n\n    -   `e`: EC50 (dose que reduz a resposta à metade).\n\nResultados:\n\n-   O modelo tem **bom ajuste** (erro residual 1.63).\n\n-   O **valor de EC50 = 0.496** indica que o isolado FGT43 é relativamente agressivo: com apenas \\~0.5 unidade de dose, a germinação já cai pela metade.\n\n### Cálculo direto do EC50 para o isolado\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#cálculo de EC50 - colocar modelo e quanto é o controle\nED(m43, 50)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nEstimated effective doses\n\n       Estimate Std. Error\ne:1:50 0.495895   0.060851\n```\n\n\n:::\n:::\n\n\n\n\n> Isso confirma que o isolado FGT43 tem uma **alta toxicidade**, afetando a germinação já em baixas doses.\n\n### Cálculo automático da EC50 para todos os isolados\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ec50estimator)\n\n\ndf_ec50 <- suppressWarnings(\n  estimate_EC50(\n    germination ~ dose,\n    data = fungi,\n    isolate_col = \"code\",\n    strata_col = \"state\",\n    interval = \"delta\",\n    fct = drc::LL.3()\n  )\n)\nhead(df_ec50)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     ID state   Estimate Std..Error      Lower      Upper\n1 FGT05    RS 0.04483863 0.01292307 0.01560462 0.07407264\n2 FGT06    RS 0.54497934 0.02245235 0.49418860 0.59577008\n3 FGT07    RS 0.88770190 0.08319526 0.69950114 1.07590265\n4 FGT28    RS 0.22608308 0.06652044 0.07560339 0.37656276\n5 FGT29    RS 0.23601581 0.02914746 0.17007969 0.30195194\n6 FGT33    RS 0.10481265 0.02114857 0.05697127 0.15265404\n```\n\n\n:::\n:::\n\n\n\n\n**Interpretação:** EC50s **variam bastante entre os isolados**, indicando **diferenças na agressividade**. Valores baixos de EC50 sugerem que o isolado inibe fortemente a germinação mesmo em **doses pequenas**.\n\n::: {.callout-warning appearance=\"minimal\"}\nA análise apresentou vários avisos \"Warning: NaNs produzidos\". Esses avisos podem ocorrer quando:\n\n-   Alguns isolados têm dados insuficientes para ajuste confiável;\n\n-   Há valores de germinação zero ou inconsistentes;\n\n-   Falta replicação em certas doses.\n:::\n\n### Visualização dos EC50s por isolado\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate))+\n  geom_point()+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](regressao_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndf_ec50 |> \n  ggplot(aes(x = Estimate))+\n  geom_histogram(bins = 10, color = \"white\")\n```\n\n::: {.cell-output-display}\n![](regressao_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n:::\n\n\n\n\n-   Isolados com menor EC50 aparecem no topo (mais agressivos);\n\n-   O histograma mostra a distribuição geral da toxicidade dos isolados;\n\n-   Alguns isolados têm **EC50s muito baixos**, sendo candidatos a maior atenção.\n\n### Conclusão biológica e estatística\n\n-   A regressão log-logística é **adequada para modelar respostas de germinação** em função da dose de inóculo, pois capta o comportamento sigmoidal esperado;\n\n-   A **EC50** permite comparar quantitativamente a **agressividade dos isolados**.\n\n-   **Isolados com EC50 baixos** são mais impactantes na germinação e podem indicar maior patogenicidade;\n\n-   A **variação entre isolados** reforça a importância de testes individuais em programas de seleção ou controle.\n",
    "supporting": [
      "regressao_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}