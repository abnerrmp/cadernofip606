{
  "hash": "b12cc0455e068ca7caa18d1e5a20006b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"anova\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)        # Importa planilhas do Google Sheets\nlibrary(tidyverse)     # Manipulação de dados, ggplot2, dplyr, etc.\nlibrary(ggplot2)       # Gráficos (pode vir via tidyverse)\nlibrary(emmeans)       # Médias ajustadas e comparações múltiplas (Tukey)\nlibrary(multcomp)      # Agrupamento de médias por letras (cld)\nlibrary(multcompView)  # Suporte para cld com letras\nlibrary(car)           # Anova para modelos glm, testes\nlibrary(MASS)          # Box-Cox, transformações\nlibrary(DHARMa)        # Diagnóstico visual de resíduos, modelos\nlibrary(rstatix)       # Testes não paramétricos, Kruskal-Wallis, Levene\nlibrary(agricolae)     # Comparações múltiplas não paramétricas\nlibrary(performance)   # check_model para diagnóstico de modelos\n```\n:::\n\n\n\n\n# **ANOVA (Análise de Variância)**\n\nA Análise de Variância (ANOVA) é um teste estatístico paramétrico projetado para comparar as médias de **três ou mais grupos independentes**. Sua principal finalidade é determinar se existem diferenças estatisticamente significativas entre as médias populacionais desses grupos, analisando a partição da variabilidade total dos dados.\n\n#### **Fundamentação Conceitual**\n\nA lógica central da ANOVA reside na decomposição da variabilidade total dos dados em dois componentes:\n\n1.  **Variabilidade entre grupos:** Diferenças atribuíveis aos tratamentos ou fatores estudados\n\n2.  **Variabilidade intra-grupos:** Variação inerente às unidades experimentais (erro aleatório)\n\nSe a variabilidade entre grupos for substancialmente maior que a variabilidade dentro dos grupos, temos evidências de que os tratamentos produzem efeitos diferenciados.\n\n#### **Formulação de Hipóteses**\n\n-   **Hipótese nula (H₀):** μ₁ = μ₂ = ... = μₖ\\\n    *(Todas as médias populacionais dos k grupos são iguais)*\n\n-   **Hipótese alternativa (Hₐ):** Pelo menos um μᵢ ≠ μⱼ\\\n    *(Existe diferença significativa entre pelo menos um par de médias)*\n\n    #### Tipos de ANOVA\n\n    | **Tipo** | **Fatores** | **Objetivo Principal** | **Exemplo Aplicado** |\n    |:-----------------|:-----------------|:-----------------|:-----------------|\n    | **One-Way ANOVA** | 1 fator | Testar efeito de um único fator categórico | Comparar crescimento de plantas com 3 fertilizantes diferentes |\n    | **Two-Way ANOVA** | 2 fatores | Avaliar efeitos principais + interações | Analisar rendimento agrícola por tipo de solo e regime de irrigação |\n\n    #### **Pressupostos Essenciais**\n\n    Para validade dos resultados, a ANOVA exige:\n\n    1.  **Independência:** Observações não correlacionadas entre grupos\n\n    2.  **Normalidade:** Distribuição aproximadamente normal dos resíduos\n\n    3.  **Homocedasticidade:** Homogeneidade das variâncias entre grupos\n\n    Quando esses pressupostos são violados, alternativas não-paramétricas como o teste de Kruskal-Wallis são recomendadas.\n\n## ANOVA - Crescimento Micelial\n\n#### Importação de dados\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmicelial <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=959387827#gid=959387827\")\n```\n:::\n\n\n\n\n#### Visualização dos dados\n\n-   `ggplot` com `geom_boxplot()` e `geom_jitter()` visualiza `tcm` por `especie`;\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmicelial |> ggplot(aes(especie, tcm)) +\n  geom_boxplot() +\n  geom_jitter(width = 0.1)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nanova1 <- aov(tcm ~ especie, data = micelial)\nanova2 <- lm(tcm ~ especie, data = micelial)\nanova(anova1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: tcm\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nespecie    4 1.46958 0.36739  19.629 2.028e-07 ***\nResiduals 25 0.46792 0.01872                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(anova2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: tcm\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nespecie    4 1.46958 0.36739  19.629 2.028e-07 ***\nResiduals 25 0.46792 0.01872                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(residuals(anova1))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(residuals(anova1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  residuals(anova1)\nW = 0.9821, p-value = 0.8782\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(tcm ~ especie, data = micelial)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  tcm by especie\nBartlett's K-squared = 4.4367, df = 4, p-value = 0.3501\n```\n\n\n:::\n\n```{.r .cell-code}\nlevene_test(tcm ~ especie, data = micelial)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 4\n    df1   df2 statistic     p\n  <int> <int>     <dbl> <dbl>\n1     4    25      1.76 0.169\n```\n\n\n:::\n:::\n\n\n\n\n#### Ajuste de modelo e ANOVA\n\nPara realizar uma análise de variância (ANOVA) com o conjunto de dados em questão, o primeiro passo é ajustar os dados a um modelo estatístico que relacione a variável resposta com a(s) variável(is) preditora(s). No exemplo, estamos interessados em avaliar se há diferença significativa nos valores de **tcm** (variável resposta) entre os diferentes níveis da variável **especie** (variável preditora).\n\nPara isso, utilizamos a função `aov()` para ajustar um modelo de ANOVA. Esse modelo assume que **tcm** varia em função dos grupos definidos por **especie**, permitindo testar se as médias de **tcm** diferem significativamente entre as espécies.\n\nEm paralelo, também utilizamos a função `lm()` (modelo linear) com a mesma fórmula.Embora `aov()` e `lm()` utilizem a mesma estrutura de modelo, `aov()` é uma forma especializada de análise de variância, enquanto `lm()` oferece um modelo linear mais geral. Ambas as abordagens podem ser submetidas à função `anova()` para gerar a tabela da análise de variância.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova1 <- aov(tcm ~ especie, data = micelial)\nanova2 <- lm(tcm ~ especie, data = micelial)\nanova(anova1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: tcm\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nespecie    4 1.46958 0.36739  19.629 2.028e-07 ***\nResiduals 25 0.46792 0.01872                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(anova2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: tcm\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nespecie    4 1.46958 0.36739  19.629 2.028e-07 ***\nResiduals 25 0.46792 0.01872                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\nPara executar uma análise de variância com o conjunto de dados trabalhado, o primeiro passo é ajustar os dados em um modelo linear. Esse ajuste é realiza através da função `lm()`, no qual a fórmula `tcm ~ especie` especifica que tcm (a variável resposta) está sendo modelada em função de especie (a variável preditora).\n\nA tabela gerada apresenta os seguintes elementos:\n\n-   **Soma dos Quadrados (Sum Sq):** Quantifica a variação explicada por cada componente do modelo (neste caso, a variação explicada por **especie** e o erro residual).\n\n-   **Graus de liberdade (Df):** Número de parâmetros associados a cada componente da variação.\n\n-   **Quadrado médio (Mean Sq):** Soma dos quadrados dividida pelos respectivos graus de liberdade.\n\n-   **Estatística F (F value):** Razão entre o quadrado médio do fator e o quadrado médio do erro. Indica a força do efeito da variável preditora sobre a variável resposta.\n\n-   **Valor-p (Pr(\\>F)):** Indica se o efeito da variável preditora é estatisticamente significativo. Um valor-p menor que 0,05 geralmente sugere que há diferenças significativas entre os grupos de **especie**.\n\n```         \n## Testes de comparação de médias\n\nAs comparações post-hoc são necessárias quando a ANOVA global é significativa.\n```\n\n### Comparações múltiplas com `emmeans`\n\nPara identificar quais médias diferem significativamente entre si após a análise de variância, é necessário aplicar um teste de comparação múltipla, como o **teste de Tukey**. Esse método é amplamente utilizado por controlar o erro do Tipo I em situações de múltiplas comparações entre grupos, mantendo a confiabilidade dos resultados mesmo quando várias médias são comparadas simultaneamente.\n\nA implementação foi feita por meio da função `emmeans()` do pacote **emmeans**, que calcula as **médias ajustadas** (também chamadas de médias marginais) da variável resposta para cada nível da variável preditora (neste caso, as espécies). Essas médias são posteriormente comparadas usando:\n\n-   A função `pairs()`, que exibe as comparações par a par entre os grupos;\n\n-   A função `pwpm()`, que mostra uma matriz com os valores-p dessas comparações;\n\n-   E a função `cld()` (do pacote **multcompView**), que **agrupa médias estatisticamente semelhantes com letras iguais**, facilitando a interpretação dos resultados. O argumento `Letters = letters` permite customizar o estilo das letras usadas nos agrupamentos.\n\nDessa forma, as letras atribuídas aos grupos indicam quais médias **não diferem significativamente entre si** a um nível de significância pré-definido (geralmente α = 0,05). Grupos com letras diferentes apresentam diferenças estatisticamente significativas nas médias da variável resposta.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nm <- emmeans(anova2, ~ especie)\nm\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n especie emmean     SE df lower.CL upper.CL\n Fasi     1.572 0.0559 25    1.457     1.69\n Faus     1.237 0.0559 25    1.122     1.35\n Fcor     1.322 0.0559 25    1.207     1.44\n Fgra     0.912 0.0559 25    0.797     1.03\n Fmer     1.427 0.0559 25    1.312     1.54\n\nConfidence level used: 0.95 \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(multcomp)\ncld(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n especie emmean     SE df lower.CL upper.CL .group\n Fgra     0.912 0.0559 25    0.797     1.03  1    \n Faus     1.237 0.0559 25    1.122     1.35   2   \n Fcor     1.322 0.0559 25    1.207     1.44   2   \n Fmer     1.427 0.0559 25    1.312     1.54   23  \n Fasi     1.572 0.0559 25    1.457     1.69    3  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 5 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\npwpm(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Fasi    Faus    Fcor    Fgra    Fmer\nFasi [1.572]  0.0023  0.0302  <.0001  0.3765\nFaus   0.335 [1.237]  0.8169  0.0031  0.1469\nFcor   0.250  -0.085 [1.322]  0.0002  0.6761\nFgra   0.660   0.325   0.410 [0.912]  <.0001\nFmer   0.145  -0.190  -0.105  -0.515 [1.427]\n\nRow and column labels: especie\nUpper triangle: P values   adjust = \"tukey\"\nDiagonal: [Estimates] (emmean) \nLower triangle: Comparisons (estimate)   earlier vs. later\n```\n\n\n:::\n\n```{.r .cell-code}\npairs(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast    estimate    SE df t.ratio p.value\n Fasi - Faus    0.335 0.079 25   4.241  0.0023\n Fasi - Fcor    0.250 0.079 25   3.165  0.0302\n Fasi - Fgra    0.660 0.079 25   8.356  <.0001\n Fasi - Fmer    0.145 0.079 25   1.836  0.3765\n Faus - Fcor   -0.085 0.079 25  -1.076  0.8169\n Faus - Fgra    0.325 0.079 25   4.115  0.0031\n Faus - Fmer   -0.190 0.079 25  -2.405  0.1469\n Fcor - Fgra    0.410 0.079 25   5.191  0.0002\n Fcor - Fmer   -0.105 0.079 25  -1.329  0.6761\n Fgra - Fmer   -0.515 0.079 25  -6.520  <.0001\n\nP value adjustment: tukey method for comparing a family of 5 estimates \n```\n\n\n:::\n:::\n\n\n\n\n## **ANOVA de dados não-paramétricos**\n\n### **Abordagens para Violação de Pressupostos na ANOVA**\n\nQuando os pressupostos fundamentais da ANOVA - **normalidade dos resíduos** e **homogeneidade das variâncias (homocedasticidade)** - não são atendidos, a validade dos resultados fica comprometida. Essa situação exige intervenções metodológicas específicas para garantir a robustez da análise. Existem três estratégias principais:\n\n#### **1. Transformação de Dados**\n\nA aplicação de funções matemáticas à variável resposta busca estabilizar variâncias e aproximar a distribuição da normalidade. A escolha da transformação depende do padrão observado nos resíduos:\n\n-   **Logarítmica (log(y))** → Indicada para dados com assimetria positiva (cauda direita alongada)\n\n-   **Raiz quadrada (√y)** → Adequada para dados de contagem (distribuição Poisson)\n\n-   **Inversa (1/y)** → Eficaz quando a média e variância são proporcionalmente relacionadas\n\n-   **Box-Cox** → Método paramétrico que identifica a transformação ótima via máxima verossimilhança\n\n**Limitação:** Resultados devem ser interpretados na escala transformada, o que pode dificultar a compreensão substantiva.\n\n#### **2. Testes Não-Paramétricos**\n\nAlternativas que não exigem distribuição normal nem homocedasticidade:\n\n-   **Kruskal-Wallis** → ANOVA baseada em ranks (substituta direta da One-Way ANOVA)\n\n-   **Teste de Friedman** → Versão para dados pareados/blocos aleatorizados\n\n-   **Métodos de comparação múltipla** → Dunn, Conover-Iman ou Nemenyi (pós-hoc após Kruskal-Wallis)\n\n**Vantagem:** Mantêm validade com distribuições assimétricas e outliers.\n\n#### **3. Modelos Lineares Generalizados (GLM)**\n\nAbordagem mais sofisticada que estende a ANOVA tradicional:\n\n-   **Binomial** → Para proporções (ex: taxa de germinação)\n\n-   **Poisson/Negative Binomial** → Para dados de contagem (ex: número de insetos)\n\n-   **Gamma** → Para dados contínuos assimétricos (ex: tempo de crescimento)\n\n    Esta abordagem estratificada permite enfrentar violações de pressupostos com ferramentas estatísticas validadas, garantindo conclusões científicas robustas mesmo quando as condições ideais não são atendidas.\n\n### Importação de dados\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsetos <- InsectSprays\n```\n:::\n\n\n\n\n### Visualização de dados\n\n-   `geom_boxplot()` + `geom_jitter()` mostram a variância entre os grupos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninsetos |> ggplot(aes(spray, count)) +\n  geom_boxplot(outlier.color = NA) +\n  geom_jitter(width = 0.1)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Ajuste de modelo e ANOVA\n\nPara realizar a análise de variância, os dados foram ajustado ao modelo linear pela função `lm()` e foi executado a `anova()`.\n\nTransformações de dados (como raiz quadrada ou logarítmica) são estratégias para estabilizar variâncias e aproximar distribuições à normalidade. Após análise, os resultados devem ser interpretados na escala original usando **`type = \"response\"`** para manter a interpretabilidade biológica.\n\n-   `bartlett.test()`, `shapiro.test()`, `qqnorm()` e `qqline()` avaliam os pressupostos da ANOVA.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ni2 <- lm(count ~ spray, data = insetos)\nanova(i2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 2668.8  533.77  34.702 < 2.2e-16 ***\nResiduals 66 1015.2   15.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(residuals(i2))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nbartlett.test(count ~ spray, data = insetos)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count by spray\nBartlett's K-squared = 25.96, df = 5, p-value = 9.085e-05\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro.test(residuals(i2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  residuals(i2)\nW = 0.96006, p-value = 0.02226\n```\n\n\n:::\n\n```{.r .cell-code}\nqqnorm(residuals(i2)); qqline(residuals(i2))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::\n\n\n\n\nA ANOVA indicou que **há diferenças significativas** entre os grupos de **spray** (p \\< 0,001), ou seja, pelo menos um grupo tem média diferente na contagem.\n\nNo entanto, os **pressupostos da ANOVA foram violados**:\n\n-   **Bartlett:** as variâncias entre os grupos **não são homogêneas** (p \\< 0,001).\n\n-   **Shapiro-Wilk:** os resíduos **não seguem distribuição normal** (p = 0,022).\n\nDessa forma, o resultado da ANOVA pode estar comprometido.\n\n### Alternativa 01: Transformações para normalidade\n\nComo os pressupostos não foram atendidos devemos tentar transformar os dados para encontrar a normalidade:\n\n-   `lm(sqrt(count) ~ spray)`: aplica transformação de raiz quadrada.\n\n-   Reanálise dos resíduos para avaliar melhoria.\n\n-   `emmeans()` + `cld()` mostram comparações com médias transformadas, com `type = \"response\"` para interpretar no valor original.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm3 <- lm(sqrt(count) ~ spray, data = insetos)\nshapiro.test(residuals(m3))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  residuals(m3)\nW = 0.98721, p-value = 0.6814\n```\n\n\n:::\n\n```{.r .cell-code}\nqqnorm(residuals(m3)); qqline(residuals(m3))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nanova(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: sqrt(count)\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 88.438 17.6876  44.799 < 2.2e-16 ***\nResiduals 66 26.058  0.3948                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nm33 <- emmeans(m3, ~ spray)\nplot(m33)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n```{.r .cell-code}\ncld(m33)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean    SE df lower.CL upper.CL .group\n C       1.24 0.181 66    0.883     1.61  1    \n E       1.81 0.181 66    1.447     2.17  12   \n D       2.16 0.181 66    1.802     2.53   2   \n A       3.76 0.181 66    3.399     4.12    3  \n B       3.88 0.181 66    3.514     4.24    3  \n F       4.02 0.181 66    3.656     4.38    3  \n\nResults are given on the sqrt (not the response) scale. \nConfidence level used: 0.95 \nNote: contrasts are still on the sqrt scale. Consider using\n      regrid() if you want contrasts of back-transformed estimates. \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\nm34 <- emmeans(m3, ~ spray, type = \"response\")\nplot(m34)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n\n```{.r .cell-code}\ncld(m34)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray response    SE df lower.CL upper.CL .group\n C         1.55 0.452 66    0.779     2.58  1    \n E         3.27 0.656 66    2.095     4.72  12   \n D         4.68 0.785 66    3.248     6.38   2   \n A        14.14 1.360 66   11.550    17.00    3  \n B        15.03 1.410 66   12.352    17.97    3  \n F        16.15 1.460 66   13.370    19.19    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the sqrt scale \nNote: contrasts are still on the sqrt scale. Consider using\n      regrid() if you want contrasts of back-transformed estimates. \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n\n\nApós aplicar a transformação por raiz quadrada na variável de contagem (`sqrt(count)`), os pressupostos da ANOVA foram atendidos, com os resíduos apresentando distribuição normal (teste de Shapiro-Wilk: p = 0,6814). A análise de variância indicou diferenças altamente significativas entre os tipos de spray (F = 44,80; p \\< 0,001), confirmando que a eficácia dos sprays varia significativamente. As comparações múltiplas com o método de Tukey mostraram que o spray **C** apresentou a menor média de insetos (mais eficaz), enquanto os sprays **A**, **B** e **F** apresentaram as maiores médias (menos eficazes). Os sprays **D** e **E** ficaram em posição intermediária. As letras de agrupamento indicam que nem todos os grupos diferem entre si, mas o spray **C** se destaca como o mais eficiente no controle dos insetos.\n\n\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\\nQuando os resíduos do modelo linear não seguem distribuição normal (verificado com `DHARMa` ou testes de normalidade), uma alternativa é realizar uma **transformação Box-Cox**, que busca uma potência (lambda) que melhore a normalidade dos dados, permitindo o uso de modelos lineares clássicos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(MASS)\nlibrary(DHARMa)\n\n# Dados\ninsects <- InsectSprays\n\n# 1. Ajustar o modelo linear\nm1 <- lm(count ~ spray, data = insects)\n\n# 2. Checar pressupostos com DHARMa (CORREÇÃO: passe o modelo 'm1', não os dados)\nsim_res <- simulateResiduals(fittedModel = m1)  # Objeto do modelo aqui!\nplot(sim_res)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# 3. Transformação Box-Cox (ajustada para evitar zeros)\n# - Adicionamos 0.1 aos dados para evitar valores zero/negativos\nb <- boxcox(lm(insects$count + 0.1 ~ 1))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n\n```{.r .cell-code}\nlambda <- b$x[which.max(b$y)]\n\n# 4. Criar variáveis transformadas\ninsects <- insects |> \n  mutate(\n    count2 = (count^lambda - 1) / lambda,  # Transformação Box-Cox\n    count3 = sqrt(count)                   # Raiz quadrada (alternativa)\n  )\n\nhist(insects$count2)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-10-3.png){width=672}\n:::\n:::\n\n\n\n\nSe a transformação for eficaz (resíduos mais próximos da normalidade), você pode seguir com ANOVA tradicional com os dados transformados:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_boxcox <- lm(count2 ~ spray, data = insects)\nanova(m1_boxcox)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count2\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 270.737  54.147  43.191 < 2.2e-16 ***\nResiduals 66  82.742   1.254                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n### Alternativa 02 - Testes Não Paramétricos (Sprays)\n\nQuando pressupostos da ANOVA não são atendidos:\n\n#### Rank-transformed ANOVA\n\n`lm(rank(count) ~ spray)`: aplica ANOVA aos ranks (ordens dos valores), menos sensível a distribuição dos dados.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm5 <- lm(rank(count) ~ spray, data = insetos)\n```\n:::\n\n\n\n\n#### Teste de Kruskal-Wallis\n\nO teste de Kruskal-Wallis é a alternativa não-paramétrica à ANOVA quando os pressupostos não são atendidos. Ele compara medianas em vez de médias, utilizando ranks dos dados. Requer significância global antes de realizar comparações pareadas, com métodos como Dunn ou Nemenyi que ajustam para múltiplas comparações.\n\n-   `kruskal.test()` e `kruskal_test()` aplicam o teste de Kruskal-Wallis, alternativa não paramétrica à ANOVA.\n\n-   `agricolae::kruskal()` realiza comparações múltiplas com letras como no `cld()`.\n\nEsse tipo de análise é ideal quando os dados são assimétricos, com outliers ou ordinalmente classificados.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkruskal.test(count ~ spray, data = insetos)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  count by spray\nKruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(rstatix)\nkruskal_test(insetos, count ~ spray)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 6\n  .y.       n statistic    df        p method        \n* <chr> <int>     <dbl> <int>    <dbl> <chr>         \n1 count    72      54.7     5 1.51e-10 Kruskal-Wallis\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(agricolae)\nkruskal(insetos$count, insetos$spray, group = TRUE, console = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nStudy: insetos$count ~ insetos$spray\nKruskal-Wallis test's\nTies or no Ties\n\nCritical Value: 54.69134\nDegrees of freedom: 5\nPvalue Chisq  : 1.510845e-10 \n\ninsetos$spray,  means of the ranks\n\n  insetos.count  r\nA      52.16667 12\nB      54.83333 12\nC      11.45833 12\nD      25.58333 12\nE      19.33333 12\nF      55.62500 12\n\nPost Hoc Analysis\n\nt-Student: 1.996564\nAlpha    : 0.05\nMinimum Significant Difference: 8.462804 \n\nTreatments with the same letter are not significantly different.\n\n  insetos$count groups\nF      55.62500      a\nB      54.83333      a\nA      52.16667      a\nD      25.58333      b\nE      19.33333     bc\nC      11.45833      c\n```\n\n\n:::\n:::\n\n\n\n\nOs resultados mostram que as duas análises são concordantes quanto ao resultado final da comparação de médias.\n\n### **Alternativa 03 - GLMs**\n\nModelos Lineares Generalizados (GLMs) são uma extensão dos modelos lineares tradicionais e são especialmente úteis quando os dados violam os pressupostos de normalidade dos resíduos exigidos pela ANOVA clássica. Isso é comum, por exemplo, quando a variável resposta representa contagens, proporções ou categorias.\n\nNo caso do conjunto de dados analisado (`insetos`), a variável `count` representa uma **contagem de insetos**, o que justifica o uso de uma distribuição da **família de Poisson**, apropriada para esse tipo de variável. O ajuste do modelo é feito com a função `glm()`, usando o argumento `family = poisson`, como mostrado no código:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm4 <- glm(count ~ spray, data = insetos, family = poisson)\n```\n:::\n\n\n\n\nApós o ajuste, a análise de variância pode ser realizada com a função `Anova()` do pacote `car`, que retorna diretamente os valores-p (diferente da função base `anova()`, que mostra apenas os desvios):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\nAnova(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: count\n      LR Chisq Df Pr(>Chisq)    \nspray   310.71  5  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\nPara avaliar se o modelo GLM ajustado se comporta adequadamente, é possível inspecionar os resíduos simulados com a função `simulateResiduals()` do pacote `DHARMa`, que oferece diagnósticos visuais eficientes para GLMs:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(simulateResiduals(m4))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\nPara comparar os efeitos dos diferentes tipos de spray, as médias ajustadas pelo modelo são calculadas com a função `emmeans()` (usando `type = \"response\"` para trazer os valores na escala original da contagem). Em seguida, a função `cld()` do pacote `multcomp` exibe as letras de agrupamento, indicando quais grupos diferem significativamente entre si com base no método de Tukey:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedias_m4 <- emmeans(m4, ~ spray, type = \"response\")\ncld(medias_m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray  rate    SE  df asymp.LCL asymp.UCL .group\n C      2.08 0.417 Inf      1.41      3.08  1    \n E      3.50 0.540 Inf      2.59      4.74  12   \n D      4.92 0.640 Inf      3.81      6.35   2   \n A     14.50 1.100 Inf     12.50     16.82    3  \n B     15.33 1.130 Inf     13.27     17.72    3  \n F     16.67 1.180 Inf     14.51     19.14    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n\n\nAlém disso, o código também utiliza a função `check_model()` do pacote `performance` para comparar visualmente a adequação dos diferentes modelos testados (`i2`, `m3`, `m4`). Essa análise visual é importante para validar os pressupostos dos modelos e justificar a escolha do modelo mais apropriado.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(i2)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-18-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-18-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-18-4.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_model(i2)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-18-5.png){width=672}\n:::\n\n```{.r .cell-code}\ncheck_model(m3)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-18-6.png){width=672}\n:::\n:::\n\n\n\n\nO modelo com transformação `sqrt(count)` apresentou bom ajuste, com resíduos normalmente distribuídos, variância homogênea e ausência de pontos influentes, atendendo bem aos pressupostos de um modelo linear. Já o modelo GLM com família Poisson respeita a natureza de contagem da variável, mas apresentou sinais de superdispersão e violação da normalidade dos resíduos. Assim, a versão transformada parece mais adequada neste caso.\n\n## ANOVA fatorial\n\nQuando o conjunto de dados apresenta **dois ou mais fatores explicativos (variáveis categóricas)**, a análise adequada é a **ANOVA fatorial** (ou multifatorial). Esse tipo de análise permite:\n\n-   Avaliar o **efeito principal** de cada fator isoladamente (por exemplo, o efeito do tratamento independentemente da dose);\n\n-   Avaliar o **efeito da interação** entre os fatores (ou seja, se o efeito de um fator depende do nível do outro).\n\nA presença de interação é importante porque, nesse caso, os efeitos dos fatores **não podem ser interpretados separadamente**. Por exemplo, uma dose pode ter um efeito positivo com um tratamento, mas não com outro.\n\nA estrutura do modelo fatorial é expressa com `fator1 * fator2`, o que automaticamente inclui os efeitos principais (`fator1 + fator2`) e o efeito da interação (`fator1:fator2`).\n\n### Importação dos dados\n\nA análise começa com a importação dos dados diretamente de uma planilha do Google Sheets, usando a função `gsheet2tbl()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nantifungicos <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=2023059672#gid=2023059672\")\n```\n:::\n\n\n\n\n### Visualização exploratória\n\nUma visualização inicial dos dados ajuda a entender como a variável resposta (`severity`) varia entre tratamentos e doses. Foi utilizado um gráfico com pontos dispersos (`geom_jitter()`) separados por `treat` (tratamento), com `dose` no eixo x.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nantifungicos |>\n  ggplot(aes(factor(dose), severity, colour = factor(dose))) +\n  geom_jitter(width=0.1) +\n  facet_wrap(~ treat) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n### Ajuste do modelo ANOVA fatorial\n\nAqui é ajustado um modelo linear com interação entre tratamento e dose. O operador `*` indica que serão considerados tanto os efeitos principais quanto a interação:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_anti <- lm(severity ~ treat * dose, data = antifungicos)\nanova(m_anti)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: severity\n           Df   Sum Sq  Mean Sq F value    Pr(>F)    \ntreat       1 0.113232 0.113232  30.358 4.754e-05 ***\ndose        1 0.073683 0.073683  19.755 0.0004077 ***\ntreat:dose  1 0.072739 0.072739  19.502 0.0004326 ***\nResiduals  16 0.059678 0.003730                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n### Verificação dos pressupostos\n\nUtilizamos a função `simulate_residuals()` para avaliar visualmente os **pressupostos da ANOVA**, como normalidade dos resíduos e homogeneidade de variâncias.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(simulate_residuals(m_anti))\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n\n### Estimativa das médias ajustadas\n\nA função `emmeans()` calcula as **médias ajustadas** (ou marginais) para cada nível de `treat` dentro de cada `dose`, e vice-versa. Isso facilita a comparação entre os grupos, considerando o modelo ajustado:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nmedia_anti <- emmeans(m_anti, ~ treat | dose)\nmedia_anti\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndose = 0.5:\n treat        emmean     SE df lower.CL upper.CL\n Ionic liquid 0.2921 0.0273 16  0.23420   0.3500\n Tebuconazole 0.0210 0.0273 16 -0.03690   0.0789\n\ndose = 2.0:\n treat        emmean     SE df lower.CL upper.CL\n Ionic liquid 0.0501 0.0273 16 -0.00781   0.1080\n Tebuconazole 0.0202 0.0273 16 -0.03768   0.0781\n\nConfidence level used: 0.95 \n```\n\n\n:::\n\n```{.r .cell-code}\nmedia_anti2 <- emmeans(m_anti, ~ dose | treat)\nmedia_anti2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat = Ionic liquid:\n dose emmean     SE df lower.CL upper.CL\n  0.5 0.2921 0.0273 16  0.23420   0.3500\n  2.0 0.0501 0.0273 16 -0.00781   0.1080\n\ntreat = Tebuconazole:\n dose emmean     SE df lower.CL upper.CL\n  0.5 0.0210 0.0273 16 -0.03690   0.0789\n  2.0 0.0202 0.0273 16 -0.03768   0.0781\n\nConfidence level used: 0.95 \n```\n\n\n:::\n:::\n\n\n\n\n### Comparações múltiplas com agrupamento por letras\n\nCom a função `cld()`, é possível visualizar os grupos que são estatisticamente diferentes, representados por letras distintas. Grupos que compartilham a mesma letra **não diferem significativamente** entre si.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedia_anti2 <-  emmeans(m_anti, ~ dose | treat)\nmedia_anti2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat = Ionic liquid:\n dose emmean     SE df lower.CL upper.CL\n  0.5 0.2921 0.0273 16  0.23420   0.3500\n  2.0 0.0501 0.0273 16 -0.00781   0.1080\n\ntreat = Tebuconazole:\n dose emmean     SE df lower.CL upper.CL\n  0.5 0.0210 0.0273 16 -0.03690   0.0789\n  2.0 0.0202 0.0273 16 -0.03768   0.0781\n\nConfidence level used: 0.95 \n```\n\n\n:::\n\n```{.r .cell-code}\ncld(media_anti)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndose = 0.5:\n treat        emmean     SE df lower.CL upper.CL .group\n Tebuconazole 0.0210 0.0273 16 -0.03690   0.0789  1    \n Ionic liquid 0.2921 0.0273 16  0.23420   0.3500   2   \n\ndose = 2.0:\n treat        emmean     SE df lower.CL upper.CL .group\n Tebuconazole 0.0202 0.0273 16 -0.03768   0.0781  1    \n Ionic liquid 0.0501 0.0273 16 -0.00781   0.1080  1    \n\nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n\n\n|          |         |        |\n|----------|---------|--------|\n| TRAT     |         |        |\n| LI       | 29,2 aA | 5,0 Ab |\n| TEBU     | 2,1 Ba  | 2,0 Aa |\n| CV = 63% |         |        |\n\n### Verificação da interação\n\nO gráfico de interação gerado pela função `interaction.plot()` permite avaliar visualmente se há **interação entre os fatores**. Linhas paralelas indicam ausência de interação; linhas que se cruzam ou divergem indicam possível interação significativa.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninteraction.plot(antifungicos$dose, antifungicos$treat, antifungicos$severity)\n```\n\n::: {.cell-output-display}\n![](testes_de_comparação_multiplos_anova_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "testes_de_comparação_multiplos_anova_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}